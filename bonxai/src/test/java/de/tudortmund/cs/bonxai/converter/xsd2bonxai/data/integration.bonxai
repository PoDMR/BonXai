default namespace http://www.example.org/books
namespace lib = http://www.example.org/library
namespace xs = http://www.w3.org/2001/XMLSchema
namespace xml = http://www.w3.org/XML/1998/namespace

groups {
    group nameTypes = {
        (
            element name { xs:string } |
            (
                element firstName { xs:string } ,
                (
                    element middleName { xs:string }
                )? ,
                element lastName { xs:string }
            )
        )
    }
    attribute-group bookAttributes = {
        attribute isbn { isbn },
        attribute available { xs:string }?
    }
}

grammar {
    //character = {
        (
            group nameTypes ,
            (
                element friend-of { lib:nameType }
            )* ,
            element since { lib:sinceType } ,
            element qualification
        )
    }
    //qualification = {
        (
            (
                skip element * { http://www.w3.org/1999/xhtml }
            )*
        )
    }
    //title = {
        attribute xml:lang { xs:string }?,
        xs:string
    }
    /book = {
        attribute-group bookAttributes,
        (
            element title &
            element author { xs:string } &
            (
                element character
            )?
        )
    }
}

constraints {
    key {http://www.example.org/books}charName /book = {
        character
        {
            name
        }
    }
    keyref charNameRef /book = {
        character
        {
            friend-of
        }
    }
}

